(function(){"use strict";var e={4324:function(e,t,s){var r=s(9242),a=s(3396);const l=(0,a.uE)('<div class="navbar-element">TONE API</div><div class="navbar-element github-link"><a href="https://github.com/Legonzaur/Tone_WebClient">Github</a></div><div class="navbar-element github-link"><a href="https://github.com/Legonzaur/ToneAPI_servermod">Northstar Server Mod</a></div><div class="spacer"></div>',4);function i(e,t){const s=(0,a.up)("router-link"),r=(0,a.up)("router-view");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("header",null,[(0,a._)("nav",null,[l,(0,a.Wm)(s,{to:"/",class:"navbar-element"},{default:(0,a.w5)((()=>[(0,a.Uk)("Players")])),_:1})])]),(0,a.Wm)(r)],64)}var o=s(89);const n={},h=(0,o.Z)(n,[["render",i]]);var p=h,d=s(2483);const c={id:"filters"},g={id:"playerView"};function u(e,t,s,r,l,i){const o=(0,a.up)("VueMultiselect"),n=(0,a.up)("PlayerList"),h=(0,a.up)("PlayerChart"),p=(0,a.up)("WeaponChart");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",c,[(0,a.Wm)(o,{selectLabel:"",deselectLabel:"remove",placeholder:"Select server",modelValue:e.models.server,"onUpdate:modelValue":t[0]||(t[0]=t=>e.models.server=t),options:e.servers,"allow-empty":!0,"custom-label":e=>e.name,onSelect:t[1]||(t[1]=t=>e.changeFilter({server:t.id})),onRemove:t[2]||(t[2]=t=>e.changeFilter({server:""}))},null,8,["modelValue","options","custom-label"]),(0,a.Wm)(o,{selectLabel:"",deselectLabel:"remove",placeholder:"Select weapon",modelValue:e.models.weapon,"onUpdate:modelValue":t[3]||(t[3]=t=>e.models.weapon=t),options:e.sortedWeaponList,"allow-empty":!0,onSelect:t[4]||(t[4]=t=>e.changeFilter({weapon:t})),onRemove:t[5]||(t[5]=t=>e.changeFilter({weapon:""}))},null,8,["modelValue","options"]),(0,a.Wm)(o,{selectLabel:"",deselectLabel:"remove",placeholder:"Search player",modelValue:e.playerHighlighted,"onUpdate:modelValue":t[6]||(t[6]=t=>e.playerHighlighted=t),options:e.sortedPlayerList,"allow-empty":!0,"custom-label":t=>e.players[t]?.username},null,8,["modelValue","options","custom-label"])]),(0,a._)("div",g,[(0,a.Wm)(n,{filters:e.filters,onHighlightPlayer:t[7]||(t[7]=t=>e.playerHighlighted=t),playerHighlighted:e.playerHighlighted},null,8,["filters","playerHighlighted"]),(0,a.Wm)(h,{filters:e.filters,onHighlightPlayer:t[8]||(t[8]=t=>e.playerHighlighted=t),playerHighlighted:e.playerHighlighted},null,8,["filters","playerHighlighted"]),(0,a.Wm)(p,{filters:{player:e.playerHighlighted,...e.filters},playerHighlighted:e.playerHighlighted},null,8,["filters","playerHighlighted"])])],64)}s(7658);var y=s(65),f=s(7139);const m=e=>((0,a.dD)("data-v-30830e9b"),e=e(),(0,a.Cn)(),e),v={class:"playerHeaders"},b=m((()=>(0,a._)("span",null,null,-1))),w=["onClick"];function k(e,t,s,r,l,i){return(0,a.wg)(),(0,a.iD)("div",{class:"playerTable",onKeydown:t[6]||(t[6]=(...t)=>e.selectNextPlayer&&e.selectNextPlayer(...t)),tabindex:"0"},[(0,a._)("div",v,[b,(0,a._)("span",{onClick:t[0]||(t[0]=t=>e.sortPlayerList("username")),class:(0,f.C_)("username"==e.sortingData.argument?"selected":"")},"Username",2),(0,a._)("span",{onClick:t[1]||(t[1]=t=>e.sortPlayerList("kills")),class:(0,f.C_)("kills"==e.sortingData.argument?"selected":"")},"K",2),(0,a._)("span",{onClick:t[2]||(t[2]=t=>e.sortPlayerList("deaths")),class:(0,f.C_)("deaths"==e.sortingData.argument?"selected":"")},"D",2),(0,a._)("span",{onClick:t[3]||(t[3]=t=>e.sortPlayerList("k/d")),class:(0,f.C_)("k/d"==e.sortingData.argument?"selected":"")},"K/D",2),(0,a._)("span",{onClick:t[4]||(t[4]=t=>e.sortPlayerList("max_kill_distance")),class:(0,f.C_)("max_kill_distance"==e.sortingData.argument?"selected":"")},"max distance",2),(0,a._)("span",{onClick:t[5]||(t[5]=t=>e.sortPlayerList("avg_kill_distance")),class:(0,f.C_)("avg_kill_distance"==e.sortingData.argument?"selected":"")},"average distance",2)]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.playerIdList,((t,s)=>((0,a.wg)(),(0,a.iD)("div",{class:"playerRow",key:t,onClick:s=>e.$emit("highlightPlayer",t),ref_for:!0,ref:"player:"+t},[(0,a._)("div",null,[(0,a._)("span",null,(0,f.zw)(s),1)]),(0,a._)("div",null,[(0,a._)("span",null,(0,f.zw)(e.players[t].username),1)]),(0,a._)("div",null,[(0,a._)("span",null,(0,f.zw)(e.players[t].kills),1)]),(0,a._)("div",null,[(0,a._)("span",null,(0,f.zw)(e.players[t].deaths),1)]),(0,a._)("div",null,[(0,a._)("span",null,(0,f.zw)(Math.round(e.players[t].kills/e.players[t].deaths*100)/100),1)]),(0,a._)("div",null,[(0,a._)("span",null,(0,f.zw)(e.players[t].max_kill_distance),1)]),(0,a._)("div",null,[(0,a._)("span",null,(0,f.zw)(Math.round(100*e.players[t].avg_kill_distance)/100),1)])],8,w)))),128))],32)}var L=(0,a.aZ)({props:{filters:Object,playerHighlighted:String},emits:["highlightPlayer"],data(){return{sortingData:{direction:-1,argument:"kills"},playerIdList:[],store:(0,y.oR)(),selected:void 0}},computed:{players(){return this.store.getters.getPlayerList(this.filters)}},watch:{players:{handler(e){e&&(this.playerIdList=[],this.sortingData.direction*=-1,this.playerIdList=Object.keys(e),this.sortPlayerList(this.sortingData.argument),this.$nextTick((()=>{const e=this.$refs["player:"+this.selected];e&&e.length>0&&e[0].classList.add("selected")})))},immediate:!0},playerHighlighted(e,t){const s=this.$refs["player:"+t];s&&(s[0].classList.remove("selected"),delete this.selected);const r=this.$refs["player:"+e];r&&(r[0].classList.add("selected"),r[0].scrollIntoView({behavior:"smooth",block:"center"}),this.selected=e)}},updated(){const e=this.$refs["player:"+this.$props.playerHighlighted];e&&e[0]&&e[0].scrollIntoView({behavior:"smooth",block:"center"})},methods:{sortPlayerList(e){e===this.sortingData.argument?this.sortingData.direction*=-1:"username"===e&&(this.sortingData.direction=1),this.sortingData.argument=e,this.playerIdList.sort(((t,s)=>{if(!this.players)return 0;let r,a;return"k/d"===e?(r=this.players[t].kills/this.players[t].deaths,a=this.players[s].kills/this.players[s].deaths):(r=this.players[t][e],a=this.players[s][e]),r<a?-1*this.sortingData.direction:r>a?1*this.sortingData.direction:0}))},selectNextPlayer(e){const t={Home:-1/0,End:1/0,PageDown:100,PageUp:-100,ArrowUp:-1,ArrowDown:1,ArrowRight:10,ArrowLeft:-10};if(!this.selected)return;if(!Object.keys(t).includes(e.key))return;e.preventDefault();const s=this.playerIdList.indexOf(this.selected);let r=s+t[e.key];r>=this.playerIdList.length&&(r=this.playerIdList.length-1),r<0&&(r=0),this.$emit("highlightPlayer",this.playerIdList[r])}}});const P=(0,o.Z)(L,[["render",k],["__scopeId","data-v-30830e9b"]]);var _=P;const H={class:"playerChart",ref:"container"};function x(e,t,s,r,l,i){const o=(0,a.up)("Scatter");return(0,a.wg)(),(0,a.iD)("div",H,[(0,a.Wm)(o,{data:e.chart,options:e.chartOptions},null,8,["data","options"])],512)}var C=s(3254),I=s(9152),D=s(3013),W=s(5866);C.kL.register(C.f$,C.od,C.jn,C.u,C.De,I.Z,D.Z);var O=(0,a.aZ)({name:"PlayerChart",props:{filters:Object,playerHighlighted:String},emits:["highlightPlayer"],components:{Scatter:W.bp},mounted(){this.refreshColors++},computed:{colors(){this.refreshColors;const e={};if(this.$refs.container){const t=getComputedStyle(this.$refs.container);e.fg=t.getPropertyValue("--foreground"),e.bg=t.getPropertyValue("--bg-color"),e.orange=t.getPropertyValue("--orange"),e.cyan=t.getPropertyValue("--cyan"),e.currentLine=t.getPropertyValue("--current-line")}else e.fg="#ffffff";return e},chart(){const e={datasets:[{label:"Players",labels:this.playerIdList||[],borderColor:e=>this.$props.playerHighlighted&&this.$props.playerHighlighted===this.playerIdList[e.index]?this.colors.orange:this.colors.cyan,backgroundColor:e=>this.$props.playerHighlighted&&this.$props.playerHighlighted===this.playerIdList[e.index]?this.colors.orange:this.colors.cyan,pointRadius:e=>this.$props.playerHighlighted&&this.$props.playerHighlighted===this.playerIdList[e.index]?20:1,pointStyle:e=>this.$props.playerHighlighted&&this.$props.playerHighlighted===this.playerIdList[e.index]?"crossRot":"dot",hoverRadius:e=>this.$props.playerHighlighted&&this.$props.playerHighlighted===this.playerIdList[e.index]?30:4,data:[]}]};return this.players?(e.datasets[0].data=this.playerIdList.map((e=>this.players?{x:this.players[e].deaths,y:this.players[e].kills}:{x:0,y:0})),e):e},chartOptions(){this.$props.playerHighlighted;const e={responsive:!0,maintainAspectRatio:!0,animation:{duration:500},layout:{autoPadding:!1},scales:{y:{title:{text:"Kills",display:!0,color:this.colors.fg},ticks:{color:this.colors.fg}},x:{title:{text:"Deaths",display:!0,color:this.colors.fg},ticks:{color:this.colors.fg}}},plugins:{tooltip:{callbacks:{label:e=>{let t;return t=this.players?this.players[e.dataset.labels[e.dataIndex]].username:e.dataset.labels[e.dataIndex],t+=" ("+e.parsed.y+" kills "+e.parsed.x+" deaths)",t}}},annotation:{},legend:{display:!1},datalabels:{formatter:(e,t)=>this.players[this.playerIdList[t.dataIndex]].username,backgroundColor:e=>this.$props.playerHighlighted&&this.$props.playerHighlighted===this.playerIdList[e.dataIndex]?this.colors.orange:null,borderColor:this.colors.fg,borderWidth:e=>this.$props.playerHighlighted&&this.$props.playerHighlighted===this.playerIdList[e.dataIndex]?1:0,borderRadius:5,display:e=>this.$props.playerHighlighted&&this.$props.playerHighlighted===this.playerIdList[e.dataIndex]?"true":"auto",align:"-45",anchor:"end",clamp:!0,color:e=>this.$props.playerHighlighted&&this.$props.playerHighlighted===this.playerIdList[e.dataIndex]?this.colors.bg:this.colors.fg}},onClick:(e,t)=>{this.$emit("highlightPlayer",t.length>0?this.playerIdList[t[0].index]:void 0)},onHover:(e,t)=>{e.native.target&&(e.native.target.style.cursor=t[0]?"pointer":"default")}};if(!this.players)return e;const t=Math.max(...Object.values(this.players).map((e=>e.deaths))),s=Math.max(...Object.values(this.players).map((e=>e.kills)));let r,a;return s>t?(r=t,a=t/s*s):(a=s,r=s/t*t),e.plugins.annotation={annotations:{line:{type:"line",yMin:0,xMin:0,yMax:a,xMax:r,borderWidth:2,borderColor:this.colors.orange,borderDash:[1,5]}}},e},players(){return this.store.getters.getPlayerList(this.filters)||{}},playerIdList(){return Object.keys(this.players)}},data(){return{store:(0,y.oR)(),refreshColors:0}}});const $=(0,o.Z)(O,[["render",x],["__scopeId","data-v-4e740fcc"]]);var V=$;const S={class:"weaponChart",ref:"container"};function j(e,t,s,r,l,i){const o=(0,a.up)("Doughnut");return(0,a.wg)(),(0,a.iD)("div",S,[(0,a.Wm)(o,{data:e.chart,options:e.chartOptions},null,8,["data","options"])],512)}C.kL.register(C.qi,C.u,C.De,D.Z);var R=(0,a.aZ)({name:"PlayerChart",props:{filters:Object,playerHighlighted:String},emits:["highlightPlayer"],components:{Doughnut:W.$I},mounted(){this.refreshColors++},computed:{colors(){this.refreshColors;const e={};if(this.$refs.container){const t=getComputedStyle(this.$refs.container);e.fg=t.getPropertyValue("--foreground"),e.bg=t.getPropertyValue("--bg-color"),e.orange=t.getPropertyValue("--orange"),e.cyan=t.getPropertyValue("--cyan"),e.yellow=t.getPropertyValue("--yellow"),e.green=t.getPropertyValue("--green"),e.purple=t.getPropertyValue("--purple"),e.red=t.getPropertyValue("--red"),e.pink=t.getPropertyValue("--pink"),e.currentLine=t.getPropertyValue("--current-line")}else e.fg="#ffffff";return e},chart(){const e=["cyan","green","orange","pink","purple","red","yellow"],t={datasets:[{label:"Weapons",labels:this.sortedWeaponList||[],borderColor:e=>this.colors.fg,backgroundColor:t=>this.colors[e[3*t.dataIndex%e.length]],data:[]}]};return this.sortedWeaponList?(t.datasets[0].data=this.sortedWeaponList.map((e=>this.weapons?this.weapons[e].kills:0)),t):t},chartOptions(){this.$props.playerHighlighted;const e={responsive:!0,maintainAspectRatio:!0,animation:{duration:500},layout:{autoPadding:!1},plugins:{datalabels:{formatter:(e,t)=>this.sortedWeaponList[t.dataIndex],backgroundColor:e=>e.dataset.backgroundColor(e),borderColor:this.colors.fg,borderRadius:25,borderWidth:2,color:this.colors.bg,display:e=>e.dataIndex===e.dataset.labels.length-1||"auto",font:{weight:"bold"},padding:6},tooltip:{callbacks:{label:e=>{let t;return this.sortedWeaponList?(console.log(this.sortedWeaponList),t=this.sortedWeaponList[e.dataIndex]):t=e.dataset.labels[e.dataIndex],t+=" ("+this.weapons[t].kills+" kills)",t}}}}};return e},weapons(){return this.store.getters.getWeaponList(this.filters)},sortedWeaponList(){if(!this.weapons)return[];const e=Object.keys(this.weapons);return e.sort(((e,t)=>Number(this.weapons[e].kills)<Number(this.weapons[t].kills)?-1:Number(this.weapons[e].kills)>Number(this.weapons[t].kills)?1:0)),e}},data(){return{store:(0,y.oR)(),refreshColors:0}}});const N=(0,o.Z)(R,[["render",j],["__scopeId","data-v-1463b4d6"]]);var M=N,Z=s(6368),z=(0,a.aZ)({name:"PlayerView",components:{PlayerList:_,PlayerChart:V,VueMultiselect:Z.ZP,WeaponChart:M},data(){return{models:{},filters:{minKills:100,minDeaths:100},store:(0,y.oR)(),playerHighlighted:void 0}},computed:{servers(){return this.store.state.servers},weapons(){return this.store.getters.getWeaponList(this.filters)},sortedWeaponList(){if(!this.weapons)return[];const e=Object.keys(this.weapons);return e.sort()},players(){return this.store.getters.getPlayerList(this.filters)},sortedPlayerList(){if(!this.players)return[];const e=Object.keys(this.players);return e.sort(((e,t)=>this.players?this.players[e].username<this.players[t].username?-1:this.players[e].username>this.players[t].username?1:0:0))}},watch:{playerHighlighted:function(e){this.fetchPlayerData({player:e,...this.filters})}},methods:{async fetchPlayerData({player:e,server:t}){if(!this.store.getters.getWeaponList({player:e,server:t}))return await this.store.dispatch("fetchWeapons",{player:e,server:t})},async changeFilter({weapon:e,server:t}){const s=JSON.parse(JSON.stringify(this.filters));void 0!==e&&(s.weapon=e),void 0!==t&&(s.server=t),""===e&&delete s.weapon,""===t&&delete s.server;const r=[];this.store.getters.getPlayerList(s)||r.push(this.store.dispatch("fetchPlayers",s)),this.store.getters.getWeaponList(s)||r.push(this.store.dispatch("fetchWeapons",s)),r.push(this.fetchPlayerData({player:this.playerHighlighted,...s})),await Promise.all(r),this.filters=s}}});const T=(0,o.Z)(z,[["render",u],["__scopeId","data-v-ac04060e"]]);var U=T;const A=[{path:"/",name:"home",component:U}],K=(0,d.p7)({history:(0,d.PO)("/Tone_WebClient/"),routes:A});var E=K;Symbol();var F=(0,y.MT)({state:{servers:[],players:{},weapons:{}},getters:{getPlayerList:e=>({server:t,weapon:s,minKills:r,minDeaths:a})=>{let l=[];return e.players[""]&&(l=Object.entries(e.players[""]).filter((([,e])=>e.kills>=r||e.deaths>=a)).map((e=>e[0]))),l.length>0&&e.players[(t||"")+(s||"")]?Object.fromEntries(Object.entries(e.players[(t||"")+(s||"")]).filter((([e])=>l.includes(e)))):e.players[(t||"")+(s||"")]},getWeaponList:e=>({server:t,player:s})=>e.weapons[(t||"")+(s||"")]},mutations:{setPlayers(e,t){e.players[(t.filters.server||"")+(t.filters.weapon||"")]=t.data},setWeapons(e,t){e.weapons[(t.filters.server||"")+(t.filters.player||"")]=t.data},setServers(e,t){e.servers=t}},actions:{async fetchPlayers(e,{weapon:t,server:s}){const r={};t?.toString()&&(r.weapon=t),s?.toString()&&(r.server=s);const a=await fetch("https://tone.sleepycat.date/v1/client/players?"+new URLSearchParams(r)),l=await a.json();Object.keys(l).forEach((e=>{l[e].kills=Number(l[e].kills),l[e].deaths=Number(l[e].deaths),l[e].max_kill_distance=Number(l[e].max_kill_distance),l[e].avg_kill_distance=Number(l[e].avg_kill_distance)})),e.commit("setPlayers",{data:l,filters:{weapon:t,server:s}})},async fetchWeapons(e,{player:t,server:s}){const r={};t?.toString()&&(r.player=t),s?.toString()&&(r.server=s);const a=await fetch("https://tone.sleepycat.date/v1/client/weapons?"+new URLSearchParams(r)),l=await a.json();e.commit("setWeapons",{data:l,filters:{player:t,server:s}})},async fetchServers(e){const t=await fetch("https://tone.sleepycat.date/v1/client/servers"),s=await t.json();e.commit("setServers",s)}},modules:{}});(0,r.ri)(p).use(F).use(E).mount("#app"),F.dispatch("fetchServers",{}),F.dispatch("fetchPlayers",{}),F.dispatch("fetchWeapons",{})}},t={};function s(r){var a=t[r];if(void 0!==a)return a.exports;var l=t[r]={exports:{}};return e[r](l,l.exports,s),l.exports}s.m=e,function(){var e=[];s.O=function(t,r,a,l){if(!r){var i=1/0;for(p=0;p<e.length;p++){r=e[p][0],a=e[p][1],l=e[p][2];for(var o=!0,n=0;n<r.length;n++)(!1&l||i>=l)&&Object.keys(s.O).every((function(e){return s.O[e](r[n])}))?r.splice(n--,1):(o=!1,l<i&&(i=l));if(o){e.splice(p--,1);var h=a();void 0!==h&&(t=h)}}return t}l=l||0;for(var p=e.length;p>0&&e[p-1][2]>l;p--)e[p]=e[p-1];e[p]=[r,a,l]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,r){var a,l,i=r[0],o=r[1],n=r[2],h=0;if(i.some((function(t){return 0!==e[t]}))){for(a in o)s.o(o,a)&&(s.m[a]=o[a]);if(n)var p=n(s)}for(t&&t(r);h<i.length;h++)l=i[h],s.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return s.O(p)},r=self["webpackChunktoneapi_webclient"]=self["webpackChunktoneapi_webclient"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=s.O(void 0,[998],(function(){return s(4324)}));r=s.O(r)})();
//# sourceMappingURL=app.31f080e6.js.map